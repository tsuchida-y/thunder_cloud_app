// firestore.rules - 修正版
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // テスト接続用（一時的）
    match /_test_connection/{document} {
      allow read, write: if true;
    }

    // users コレクション
    match /users/{userId} {
      allow write: if true;
      allow read: if true;  // ← 一時的に読み取りも許可
    }

    // weather_cache コレクション（気象データキャッシュ）
    match /weather_cache/{cacheId} {
      allow read: if true;   // 誰でも読み取り可能
      allow write: if false; // Firebase Functionsのみ書き込み可能
    }

    // photos コレクション（写真データ）
    match /photos/{photoId} {
      allow read: if true;   // 誰でも読み取り可能
      allow write: if true;  // 誰でも書き込み可能（開発用）
    }

    // likes コレクション（いいね）
    match /likes/{likeId} {
      allow read: if true;
      allow write: if true;
    }

    // comments コレクション（コメント）
    match /comments/{commentId} {
      allow read: if true;
      allow write: if true;
    }

    // downloads コレクション（ダウンロード済み写真）
    match /downloads/{downloadId} {
      allow read: if true;
      allow write: if true;
    }

    // debug コレクション（テスト用）
    match /debug/{document} {
      allow read, write: if true;
    }

    // その他は全て拒否
    match /{document=**} {
      allow read, write: if false;
    }
  }
}